<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Informed AF — Bill Tracker</title>
  <style>
    body { background:#000; color:#fff; font-family:system-ui,sans-serif; margin:0; }
    .wrap { max-width:900px; margin:30px auto; padding:0 16px; }
    h1 { font-size:1.6rem; margin-bottom:6px; }
    .controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;align-items:end}
    .controls input,.controls select{background:#0a1128;color:#fff;border:1px solid #333;border-radius:8px;padding:8px 10px;font-size:14px;min-width:96px}
    .btn{background:#ee3a4a;color:#fff;border:none;padding:8px 14px;border-radius:8px;font-weight:700;cursor:pointer}
    .btn.outline{background:transparent;border:1px solid #333}
    .chip{display:inline-flex;align-items:center;gap:6px;background:#16171b;border:1px solid #333;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:800;text-transform:uppercase}
    .barwrap{background:#090d18;border:1px solid #333;border-radius:999px;overflow:hidden;height:8px;margin:10px 0}
    .bar{background:linear-gradient(90deg,#ee3a4a,#ff6a77);height:8px;width:0;transition:width .6s ease}
    .meta{color:#a5aab4;font-size:14px;margin:8px 0}
    .topics{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .topic{background:#0f1424;border:1px solid #333;border-radius:999px;padding:4px 10px;font-size:12px;color:#dbe6ff}
    .list{margin-top:12px;display:grid;gap:6px}
    .action{font-size:14px;border-bottom:1px solid #222;padding-bottom:6px;margin-bottom:6px}
    a{color:#7ab8ff;text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 id="billTitle">Bill Tracker</h1>
    <div class="controls">
      <input id="congressInput" type="number" value="119" min="100" max="999" title="Congress" />
      <select id="billType">
        <option value="hr">HR</option>
        <option value="hjres">HJRes</option>
        <option value="sjres">SJRes</option>
        <option value="s">S</option>
      </select>
      <input id="billNumber" type="number" placeholder="Bill number" />
      <button class="btn" id="trackBtn">Track</button>
      <button class="btn outline" id="copyLinkBtn">Copy link</button>
    </div>

    <div class="chip" id="statusChip">—</div>
    <div class="barwrap"><div class="bar" id="bar"></div></div>

    <div class="meta" id="summary"></div>
    <div class="topics" id="topics"></div>

    <div class="list">
      <div><strong>Sponsor:</strong> <span id="sponsor">—</span></div>
      <div><strong>Party:</strong> <span id="party">—</span></div>
      <div><strong>Cosponsors:</strong> <span id="cosponsors">—</span></div>
      <div><strong>Committees:</strong> <div id="committees">—</div></div>
      <div><strong>Last Updated:</strong> <span id="lastUpdated">—</span></div>
      <div><a id="link" href="#" target="_blank">Read full bill text →</a></div>
    </div>

    <h3>Latest Actions</h3>
    <div class="list" id="actions"></div>
  </div>

  <script>
    const API_KEY = "mK6ppM10yF5AswhzAqOuCxkBg1LfO7yNEaJeg6M2";

    function congressOrdinal(n) {
      n = +n;
      const j = n % 10, k = n % 100;
      if (j === 1 && k !== 11) return n + 'st';
      if (j === 2 && k !== 12) return n + 'nd';
      if (j === 3 && k !== 13) return n + 'rd';
      return n + 'th';
    }
    function billPathSegment(type) {
      const map = {
        hr: 'house-bill',
        s: 'senate-bill',
        hjres: 'house-joint-resolution',
        sjres: 'senate-joint-resolution',
        hconres: 'house-concurrent-resolution',
        sconres: 'senate-concurrent-resolution',
        hres: 'house-resolution',
        sres: 'senate-resolution'
      };
      return map[type] || 'bill';
    }
    function humanBillUrl(congress, type, num) {
      return `https://www.congress.gov/bill/${congressOrdinal(congress)}-congress/${billPathSegment(type)}/${num}`;
    }

    async function loadBill(){
      const congress=document.getElementById('congressInput').value.trim()||'119';
      const type=document.getElementById('billType').value;
      const num=document.getElementById('billNumber').value.trim();
      if(!num) return alert('Enter bill number');

      const url=`https://api.congress.gov/v3/bill/${congress}/${type}/${num}?format=json&api_key=${API_KEY}`;
      try{
        const r=await fetch(url);
        if(!r.ok) throw new Error('Bad response');
        const data=await r.json();
        const bill=data.bill;

        document.getElementById('billTitle').textContent=bill.title||bill.titleWithoutNumber||bill.number;
        document.getElementById('summary').textContent=bill.summaries?.[0]?.text||'';
        document.getElementById('link').href = humanBillUrl(congress, type, num);
        document.getElementById('lastUpdated').textContent=new Date().toLocaleString();

        const status=bill.latestAction?.text||'No status';
        const chip=document.getElementById('statusChip');
        chip.textContent=status;

        let idx=0; const stages=['Introduced','In Committee','On Floor','Passed','To President','Enacted'];
        if(status.toLowerCase().includes('pass')) idx=3;
        if(status.toLowerCase().includes('enacted')) idx=5;
        document.getElementById('bar').style.width=`${(idx/(stages.length-1))*100}%`;

        if(bill.sponsors?.[0]){
          const s=bill.sponsors[0];
          document.getElementById('sponsor').textContent=`${s.fullName} (${s.state})`;
          document.getElementById('party').textContent=s.partyName||s.partyCode||'—';
        }

        document.getElementById('cosponsors').textContent=bill.cosponsors?bill.cosponsors.length:'0';

        const commEl=document.getElementById('committees');
        if(bill.committees?.length){
          commEl.innerHTML=bill.committees.map(c=>{
            const chamber=c.chamber||'';
            const badge=chamber?`<span class="badge ${chamber.toLowerCase()}">${chamber}</span>`:'';
            const subs=(c.subcommittees||[]).length?`<div class="subs">${c.subcommittees.map(s=>`↳ ${s.name}`).join('<br>')}</div>`:'';
            return `<div class="committee">${badge}${c.name}${subs}</div>`;
          }).join('');
        } else { commEl.textContent='—'; }

        let actionsArr = bill.actions || [];
        try {
          const actionsResp = await fetch(`https://api.congress.gov/v3/bill/${congress}/${type}/${num}/actions?format=json&api_key=${API_KEY}`);
          if(actionsResp.ok){
            const ad = await actionsResp.json();
            actionsArr = ad.actions || ad.bill?.actions || actionsArr;
          }
        } catch (e) {}

        document.getElementById('actions').innerHTML = (actionsArr||[]).slice(-12).reverse().map(a=>`<div class="action"><strong>${new Date(a.actionDate || a.date || Date.now()).toLocaleString()}</strong>: ${a.text || a.description}</div>`).join('');
      }catch(e){
        console.error(e);
        alert('Error loading bill');
      }
    }

    document.getElementById('trackBtn').addEventListener('click',loadBill);
    document.getElementById('copyLinkBtn').addEventListener('click',()=>{
      navigator.clipboard.writeText(location.href).then(()=>{
        document.getElementById('copyLinkBtn').textContent='Copied!';
        setTimeout(()=>document.getElementById('copyLinkBtn').textContent='Copy link',1200);
      });
    });
  </script>
</body>
</html>