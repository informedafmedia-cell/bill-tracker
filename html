<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bill Tracker</title>
  <style>
    body { background:#000; color:#fff; font-family: system-ui, sans-serif; margin:0; }
    .wrap { max-width:900px; margin:30px auto; padding:0 16px; }
    h1 { font-size:1.6rem; margin-bottom:6px; }
    .controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;align-items:end}
    .controls input,.controls select{background:#0a1128;color:#fff;border:1px solid #333;border-radius:8px;padding:8px 10px;font-size:14px;min-width:96px}
    .btn{background:#ee3a4a;color:#fff;border:none;padding:8px 14px;border-radius:8px;font-weight:700;cursor:pointer}
    .btn.outline{background:transparent;border:1px solid #333}
    .chip{display:inline-flex;align-items:center;gap:6px;background:#16171b;border:1px solid #333;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:800;text-transform:uppercase}
    .chip.ok{border-color:#2ecc71;color:#b7ffcb}.chip.bad{border-color:#e74c3c;color:#ffc7c7}.chip.warn{border-color:#f39c12;color:#ffe5b7}
    .barwrap{background:#090d18;border:1px solid #333;border-radius:999px;overflow:hidden;height:8px;margin:10px 0}
    .bar{background:linear-gradient(90deg,#ee3a4a,#ff6a77);height:8px;width:0;transition:width .6s ease}
    .meta{color:#a5aab4;font-size:14px;margin:8px 0}
    .topics{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .topic{background:#0f1424;border:1px solid #333;border-radius:999px;padding:4px 10px;font-size:12px;color:#dbe6ff}
    .comm-wrap{position:relative;margin-top:8px}
    .comm-list{display:grid;gap:6px}
    .committee{line-height:1.35}
    .committee .subs{margin-left:14px;color:#a5aab4;font-size:13px;display:grid;gap:4px}
    .badge{display:inline-block;font-size:11px;padding:2px 6px;border:1px solid #333;border-radius:999px;margin-right:6px;background:#0f1424}
    .badge.house{border-color:rgba(59,130,246,.5)}.badge.senate{border-color:rgba(239,68,68,.5)}
    .collapse{max-height:120px;overflow:hidden;position:relative}
    .collapse.fade:after{content:"";position:absolute;left:0;right:0;bottom:0;height:48px;background:linear-gradient(180deg,rgba(0,0,0,0),#000)}
    .toggle{margin-top:8px;font-size:12px;color:#7ab8ff;cursor:pointer;user-select:none}
    .list{margin-top:12px;display:grid;gap:6px}
    .action{font-size:14px;border-bottom:1px solid #222;padding-bottom:6px;margin-bottom:6px}
    a{color:#7ab8ff;text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 id="billTitle">Bill Tracker</h1>
    <div class="controls">
      <input id="congressInput" type="number" value="118" min="100" max="999" title="Congress" />
      <select id="billType">
        <option value="hr">HR</option>
        <option value="hjres">HJRes</option>
        <option value="sjres">SJRes</option>
        <option value="s">S</option>
      </select>
      <input id="billNumber" type="number" placeholder="Bill number" />
      <button class="btn" id="trackBtn">Track</button>
      <button class="btn outline" id="copyLinkBtn">Copy link</button>
    </div>

    <div class="chip warn" id="statusChip">—</div>
    <div class="barwrap"><div class="bar" id="bar"></div></div>

    <div class="meta" id="summary"></div>
    <div class="topics" id="topics"></div>

    <div class="list">
      <div><strong>Sponsor:</strong> <span id="sponsor">—</span></div>
      <div><strong>Party:</strong> <span id="party">—</span></div>
      <div><strong>Cosponsors:</strong> <span id="cosponsors">—</span></div>
      <div><strong>Committees:</strong> <div id="committees">—</div></div>
      <div><strong>Last Updated:</strong> <span id="lastUpdated">—</span></div>
      <div><a id="link" href="#" target="_blank">Read full bill text →</a></div>
    </div>

    <h3>Latest Actions</h3>
    <div class="list" id="actions"></div>
  </div>

  <script>
    async function loadBill(){
      const congress=document.getElementById('congressInput').value.trim()||'118';
      const type=document.getElementById('billType').value;
      const num=document.getElementById('billNumber').value.trim();
      if(!num) return alert('Enter bill number');

      const url=`https://api.congress.gov/v3/bill/${congress}/${type}/${num}?format=json`;
      try{
        const r=await fetch(url);
        if(!r.ok) throw new Error('Bad response');
        const data=await r.json();
        const bill=data.bill;

        document.getElementById('billTitle').textContent=bill.title||bill.titleWithoutNumber||bill.number;
        document.getElementById('summary').textContent=bill.summaries?.[0]?.text||'';
        document.getElementById('link').href=bill.url;
        document.getElementById('lastUpdated').textContent=new Date().toLocaleString();

        // Status
        const status=bill.latestAction?.text||'No status';
        const chip=document.getElementById('statusChip');
        chip.textContent=status;

        // Progress heuristic
        let idx=0; const stages=['Introduced','In Committee','On Floor','Passed','To President','Enacted'];
        if(status.toLowerCase().includes('pass')) idx=3;
        if(status.toLowerCase().includes('enacted')) idx=5;
        document.getElementById('bar').style.width=`${(idx/(stages.length-1))*100}%`;

        // Sponsor + party
        if(bill.sponsors?.[0]){
          const s=bill.sponsors[0];
          document.getElementById('sponsor').textContent=`${s.fullName} (${s.state})`;
          document.getElementById('party').textContent=s.partyName||s.partyCode||'—';
        }

        // Cosponsors
        document.getElementById('cosponsors').textContent=bill.cosponsors?bill.cosponsors.length:'0';

        // Committees + subcommittees
        const commEl=document.getElementById('committees');
        if(bill.committees?.length){
          commEl.innerHTML=bill.committees.map(c=>{
            const chamber=c.chamber||'';
            const badge=chamber?`<span class=\"badge ${chamber.toLowerCase()}\">${chamber}</span>`:'';
            const subs=(c.subcommittees||[]).length?`<div class=\"subs\">${c.subcommittees.map(s=>`↳ ${s.name}`).join('<br>')}</div>`:'';
            return `<div class=\"committee\">${badge}${c.name}${subs}</div>`;
          }).join('');
        } else { commEl.textContent='—'; }

        // ===== Extra fetches for full history & subjects =====
        let actionsArr = bill.actions || [];
        let topicsArr = [];
        try {
          const [actionsResp, subjectsResp] = await Promise.all([
            fetch(`https://api.congress.gov/v3/bill/${congress}/${type}/${num}/actions?format=json`),
            fetch(`https://api.congress.gov/v3/bill/${congress}/${type}/${num}/subjects?format=json`)
          ]);
          if(actionsResp && actionsResp.ok){
            const ad = await actionsResp.json();
            actionsArr = ad.actions || ad.bill?.actions || actionsArr;
          }
          if(subjectsResp && subjectsResp.ok){
            const sd = await subjectsResp.json();
            const raw = sd.subjects || sd.bill?.subjects || [];
            topicsArr = raw.map(s => s?.name || s?.legislativeSubject || s).filter(Boolean);
          }
        } catch (e) { /* fail soft and use bill fields */ }

        // Topics chips (fallback to any subjects on main payload)
        if(!topicsArr.length && Array.isArray(bill.subjects)){
          topicsArr = bill.subjects.map(s=>s?.name || s).filter(Boolean);
        }
        const uniqueTopics = Array.from(new Set(topicsArr)).slice(0,10);
        document.getElementById('topics').innerHTML = uniqueTopics.map(t=>`<span class=\"topic\">${t}</span>`).join('');

        // Actions (latest first, prefer expanded list if available)
        document.getElementById('actions').innerHTML = (actionsArr||[]).slice(-12).reverse().map(a=>`<div class=\"action\"><strong>${new Date(a.actionDate || a.date || a.datetime || a.updateDate || Date.now()).toLocaleString()}</strong>: ${a.text || a.description}</div>`).join('');
        document.getElementById('actions').innerHTML=(bill.actions||[]).slice(-8).reverse().map(a=>`<div class="action"><strong>${new Date(a.actionDate).toLocaleDateString()}</strong>: ${a.text}</div>`).join('');
      }catch(e){
        console.error(e);
        alert('Error loading bill');
      }
    }

    document.getElementById('trackBtn').addEventListener('click',loadBill);
    document.getElementById('copyLinkBtn').addEventListener('click',()=>{
      navigator.clipboard.writeText(location.href).then(()=>{
        document.getElementById('copyLinkBtn').textContent='Copied!';
        setTimeout(()=>document.getElementById('copyLinkBtn').textContent='Copy link',1200);
      });
    });
  </script>
</body>
</html>


